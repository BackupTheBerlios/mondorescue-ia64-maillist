<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mondorescue-ia64] R: R: R: R: R: R: R: R: Recovery fromtapeKO(OBDR)
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/mondorescue-ia64/2009-March/index.html" >
   <LINK REL="made" HREF="mailto:mondorescue-ia64%40lists.berlios.de?Subject=Re%3A%20%5BMondorescue-ia64%5D%20R%3A%20R%3A%20R%3A%20R%3A%20R%3A%20R%3A%20R%3A%20R%3A%20Recovery%20fromtapeKO%28OBDR%29&In-Reply-To=%3C81FB9FBE83D9134AAC7D9884ACDF130B01B2B875%40BESONE.corp.dom%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000056.html">
   <LINK REL="Next"  HREF="000058.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mondorescue-ia64] R: R: R: R: R: R: R: R: Recovery fromtapeKO(OBDR)</H1>
    <B>Grassi Giuseppe</B> 
    <A HREF="mailto:mondorescue-ia64%40lists.berlios.de?Subject=Re%3A%20%5BMondorescue-ia64%5D%20R%3A%20R%3A%20R%3A%20R%3A%20R%3A%20R%3A%20R%3A%20R%3A%20Recovery%20fromtapeKO%28OBDR%29&In-Reply-To=%3C81FB9FBE83D9134AAC7D9884ACDF130B01B2B875%40BESONE.corp.dom%3E"
       TITLE="[Mondorescue-ia64] R: R: R: R: R: R: R: R: Recovery fromtapeKO(OBDR)">giuseppe.grassi2 at italtel.it
       </A><BR>
    <I>Mon Mar 16 16:29:01 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000056.html">[Mondorescue-ia64] R: R: R: R: R: R: R: Recovery	from	tapeKO(OBDR)
</A></li>
        <LI>Next message: <A HREF="000058.html">[Mondorescue-ia64] R: R: R: R: R: R: R: R:	Recovery	fromtapeKO(OBDR)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57">[ date ]</a>
              <a href="thread.html#57">[ thread ]</a>
              <a href="subject.html#57">[ subject ]</a>
              <a href="author.html#57">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Bruno,
thanks to you for the help.

See comments in mail text.
Best regards
Giuseppe

&gt;<i> Da: Bruno Cornec [mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/mondorescue-ia64">Bruno.Cornec at hp.com</A>] 
</I>&gt;<i> Inviato: mercoled&#236; 11 marzo 2009 14.49
</I>&gt;<i> A: Grassi Giuseppe
</I>&gt;<i> Cc: <A HREF="https://lists.berlios.de/mailman/listinfo/mondorescue-ia64">mondorescue-ia64 at lists.berlios.de</A>
</I>&gt;<i> Oggetto: Re: R: R: R: R: R: [Mondorescue-ia64] R: R: Recovery 
</I>&gt;<i> fromtapeKO(OBDR)
</I>&gt;<i> 
</I>&gt;<i> &gt; Compilation error due to  &quot;use strict;&quot;  instruction, so I 
</I>&gt;<i> have deleted.
</I>&gt;<i> 
</I>&gt;<i> You shouldn't ;-) I don't want to publish a perl script which 
</I>&gt;<i> doesn't work with use strict. We really need to solve what is 
</I>&gt;<i> wrong with it, but keep the use strict. That's a very 
</I>&gt;<i> important perl feature I want to use.
</I>&gt;<i> 
</I>&gt;<i> Could you send me the errors reported with use strict so that 
</I>&gt;<i> I could fix them ?
</I>&gt;<i> On my side I have that:
</I>&gt;<i> $ perl -c mindi/parted2fdisk.pl
</I>&gt;<i> mindi/parted2fdisk.pl syntax OK
</I>&gt;<i> 
</I>&gt;<i> So can't really see what is causing the issue (maybe realated 
</I>&gt;<i> to your execution context).
</I>
Perl compilation log is attached.



&gt;<i> &gt; There is an other problem on the last command send to parted2fdisk:
</I>&gt;<i> &gt; &quot;a 00&quot;  to &quot;toggle a bootable flag&quot; the partition 00 doesn't exist. 
</I>&gt;<i> &gt; Is a mondorestore.c problem ?
</I>&gt;<i> 
</I>&gt;<i> I think so :-( I don't really know how this is triggered. 
</I>&gt;<i> Could you provide the log file with full debug mode (-K 99) 
</I>&gt;<i> in order for me to see what is happening there ? Thanks in advance.
</I>
Mmondorestore.log  run with -K99 option is attached

&gt;<i> &gt; I force $part=1 in case of &quot;a&quot; command, because the... 00 
</I>&gt;<i> is not 00 but ....
</I>&gt;<i> 
</I>&gt;<i> I think we need to solve that for good.
</I>&gt;<i> I did that in between: $part = 1 if ($part le 0); which 
</I>&gt;<i> doesn't seem to work for you :-(
</I>&gt;<i> 
</I>&gt;<i> &gt; During parted2fdisk execution the following error appears:
</I>&gt;<i> &gt;                              Use of uninitialized value in 
</I>&gt;<i> pattern match (m//) at /sbin/parted2fdisk line 537, &lt;PARTED&gt; line 1.
</I>&gt;<i> &gt;            Use of uninitialized value in pattern match 
</I>&gt;<i> (m//) at /sbin/parted2fdisk line 537, &lt;PARTED&gt; line 1.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; it is possible to eliminate the error removing - w in first line
</I>&gt;<i> 
</I>&gt;<i> Yes, but again, this is just masking the problem, but not 
</I>&gt;<i> solving it ;-) And in fact as it shouldn't happen it reveals 
</I>&gt;<i> an error somewhere in the script.
</I>&gt;<i> 
</I>&gt;<i> &gt; &gt; &gt; An other modification is necessary in /sbin/post-init 
</I>&gt;<i> in order to
</I>&gt;<i> &gt; &gt; &gt; - eliminate the error (touch: cannot touch 
</I>&gt;<i> `/boot/boot.b': No such 
</I>&gt;<i> &gt; &gt; &gt; file or directory)
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; I don't understand where that one comes from. I have no boot.b 
</I>&gt;<i> &gt; &gt; string in the project's code at all. So creating /boot, just to 
</I>&gt;<i> &gt; &gt; remove that error messages doesn't appeal to me. I'd prefer to 
</I>&gt;<i> &gt; &gt; understand where does that come from.
</I>&gt;<i> &gt; &gt; Normaly it was Fixed in revision 2085 (Cf:
</I>&gt;<i> &gt; &gt; <A HREF="http://trac.mondorescue.org/changeset/2085">http://trac.mondorescue.org/changeset/2085</A>)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; mondo-2.2.8 is running on my server (the 2085 revision is 
</I>&gt;<i> included) but the problem is present yet.
</I>&gt;<i> &gt; See  mondorestore.log  attached.
</I>&gt;<i> 
</I>&gt;<i> Humm. 
</I>&gt;<i> 
</I>&gt;<i> &gt; In attach the module &quot;libmondo-cli.c&quot; in my installation.
</I>&gt;<i> &gt; I think that &quot;touch /boot/boot.b&quot; is executed because the 
</I>&gt;<i> __freeBSD__ 
</I>&gt;<i> &gt; is not defined and my archtecture is __IA64, so the branch 
</I>&gt;<i> is executed:
</I>&gt;<i> &gt;        
</I>&gt;<i> &gt; #ifndef __FreeBSD__
</I>&gt;<i> &gt;         if ((!is_this_a_valid_disk_format(&quot;vfat&quot;)) &amp;&amp; (! 
</I>&gt;<i> &gt; bkpinfo-&gt;restore_data)) { ...................
</I>&gt;<i> &gt; ...................     
</I>&gt;<i> &gt; #ifdef __IA64__
</I>&gt;<i> &gt;         /* We force ELILO usage on IA64 */
</I>&gt;<i> &gt;         bkpinfo-&gt;make_cd_use_lilo = TRUE;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;         if (bkpinfo-&gt;make_cd_use_lilo &amp;&amp; 
</I>&gt;<i> !does_file_exist(&quot;/boot/boot.b&quot;)) {
</I>&gt;<i> &gt;                 paranoid_system(&quot;touch /boot/boot.b&quot;);
</I>&gt;<i> &gt;         }
</I>&gt;<i> &gt; #endif
</I>&gt;<i> 
</I>&gt;<i> That code changed in r2134 (Cf:
</I>&gt;<i> <A HREF="http://trac.mondorescue.org/changeset/2134">http://trac.mondorescue.org/changeset/2134</A>)
</I>&gt;<i> 
</I>&gt;<i> I'll produce a beta for you to test. Hopefully that should 
</I>&gt;<i> really be gone now.
</I>
OK in mondo-2.2.9-1.rhel4 &quot;touch /boot/boot.b&quot; is not present.

&gt;<i> 
</I>&gt;<i> &gt; The variable $ARCH in LounchTerminals is not set. See 
</I>&gt;<i> below. Probably it is due to the fact that $ARCH is set in a 
</I>&gt;<i> function (WelcomeMessage) not in the main.
</I>&gt;<i> 
</I>&gt;<i> Arggh!
</I>&gt;<i> Changed again then in r2163 (Cf:
</I>&gt;<i> <A HREF="http://trac.mondorescue.org/changeset/2163">http://trac.mondorescue.org/changeset/2163</A>)
</I>

OK  &quot;init&quot; in changeset 2163 

&gt;<i> 
</I>&gt;<i> &gt; &gt; Oh, oh ! Bug here. Fixed in rev 2157
</I>&gt;<i> &gt; &gt; <A HREF="http://trac.mondorescue.org/changeset/2157">http://trac.mondorescue.org/changeset/2157</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I have apply the modification at the Makefile.am like in changeset 
</I>&gt;<i> &gt; 2157 but the script &quot;format-and-kludge-vfat&quot; is not present when 
</I>&gt;<i> &gt; mondorestore launch it
</I>&gt;<i> 
</I>&gt;<i> Humm. It's working for me locally:
</I>&gt;<i> $ rpm -qlp &gt; 
</I>&gt;<i> /users/bruno/pb/projects/mondorescue/build/RPMS/x86_64/mondo-2
</I>&gt;<i> .2.9-1.mdv2009.0.x86_64.rpm | grep kludge 
</I>&gt;<i> /usr/share/mondo/restore-scripts/mondo/format-and-kludge-vfat
</I>&gt;<i> 
</I>&gt;<i> Please re-test with the version I'll provide to you.
</I>
OK with mondo-2.2.9-1 rhel4, format-and-kludge-vfat is present but doesn't work correctly
See mondorestore.log (script format-and-kludge-vfat is run with 2 parameters but only one parameter is required). I have tried to exec the script with &quot;set -x&quot;. See following:

# sh -c 'echo -en &quot;y\ny\ny\n&quot; | format-and-kludge-vfat /dev/cciss/c0d0p1'
+ LogIt format-and-kludge-vfat --- starting
+ echo format-and-kludge-vfat --- starting
format-and-kludge-vfat --- starting
+ touch /tmp/fakv.log
+ [ 1 -eq 2 ]
+ [ 1 -ne 1 ]
+ retval=0
+ device=/dev/cciss/c0d0p1
+ sed s/[0-9]*[0-9]//         
+ echo /dev/cciss/c0d0p1
+ drive=/dev/cciss/cd0p1     
+ echo /dev/cciss/c0d0p1
+ sed s%/dev/cciss/cd0p1%%
+ partition=/dev/cciss/c0d0p1
+ GetPartitionFdiskType /dev/cciss/c0d0p1 /dev/cciss/cd0p1
+ local drive device ftype
+ device=/dev/cciss/c0d0p1
+ drive=/dev/cciss/cd0p1
+ parted2fdisk -l /dev/cciss/cd0p1
+ grep /dev/cciss/c0d0p1
+ tr *
+ tr -s \t
+ cut -d  -f5
+ ftype=
+ Die Error: Unsuitable partition type  (or device /dev/cciss/c0d0p1 doesn't exist)
+ LogIt (format-and-kludge-vfat) Error: Unsuitable partition type  (or device /dev/cciss/c0d0p1 doesn't exist) 1
+ echo (format-and-kludge-vfat) Error: Unsuitable partition type  (or device /dev/cciss/c0d0p1 doesn't exist)
(format-and-kludge-vfat) Error: Unsuitable partition type  (or device /dev/cciss/c0d0p1 doesn't exist)
+ cat /tmp/fakv.log
+ exit 1
+ type=
+ res=1
+ retval=1
+ [ 1 -ne 0 ]
+ exit 1
# cat  /tmp/fakv.log
#

I think sed command is not correct for cciss disks. Drive will be /dev/cciss/c0d0  not/dev/cciss/cd0p1. sed command is correct in case of scsi direct attached disk: /dev/scsi/sda1 but is not correct for smartarray controller disks


&gt;<i> 
</I>&gt;<i> &gt; The beta 2.2.9 version is only for redhat 5 ?
</I>&gt;<i> 
</I>&gt;<i> It's for what I decide ;-) 
</I>&gt;<i> 
</I>&gt;<i> &gt; I am working on red hat 4.7 now. However I have applied the changes 
</I>&gt;<i> &gt; above (changeset 2157, 2158)to 2.2.8 mondo version
</I>&gt;<i> 
</I>&gt;<i> I can provide to you a beta for rhel4 without issue.
</I>&gt;<i> It's now at <A HREF="ftp://ftp.mondorescue.org/test/rhel/4">ftp://ftp.mondorescue.org/test/rhel/4</A>
</I>&gt;<i> 
</I>&gt;<i> &gt; a
</I>&gt;<i> &gt; 00
</I>&gt;<i> &gt; part=00
</I>&gt;<i> 
</I>&gt;<i> Ok, so mondorestore doesn't pass the correct value to 
</I>&gt;<i> parted2fdisk. It's clear from that log portion :-( I need to 
</I>&gt;<i> find why if you can call it with -K99 that may help.
</I>
In attach the mondorestore.log run with -K99 option

&gt;<i> 
</I>&gt;<i> Thanks again,
</I>&gt;<i> Bruno.
</I>&gt;<i> -- 
</I>&gt;<i> Linux Profession Lead EMEA  / Open Source Ambassador \   EMEA 
</I>&gt;<i> CME Sol. Center
</I>&gt;<i> <A HREF="http://www.mondorescue.org">http://www.mondorescue.org</A> / HP/Intel Solution Center \  
</I>&gt;<i> <A HREF="http://hpintelco.net">http://hpintelco.net</A>
</I>&gt;<i> Des infos sur Linux?  <A HREF="http://www.HyPer-Linux.org">http://www.HyPer-Linux.org</A>      
</I>&gt;<i> <A HREF="http://www.hp.com/linux">http://www.hp.com/linux</A>
</I>&gt;<i> La musique ancienne?  <A HREF="http://www.musique-ancienne.org">http://www.musique-ancienne.org</A> 
</I>&gt;<i> <A HREF="http://www.medieval.org">http://www.medieval.org</A>
</I>&gt;<i> 
</I>

Internet Email Confidentiality Footer
-----------------------------------------------------------------------------------------------------
La presente comunicazione, con le informazioni in essa contenute e ogni documento o file allegato, e' rivolta unicamente alla/e persona/e cui e' indirizzata ed alle altre da questa autorizzata/e a riceverla. Se non siete i destinatari/autorizzati siete avvisati che qualsiasi azione, copia, comunicazione, divulgazione o simili basate sul contenuto di tali informazioni e' vietata e potrebbe essere contro la legge (art. 616 C.P., D.Lgs n. 196/2003 Codice in materia di protezione dei dati personali). Se avete ricevuto questa comunicazione per errore, vi preghiamo di darne immediata notizia al mittente e di distruggere il messaggio originale e ogni file allegato senza farne copia alcuna o riprodurne in alcun modo il contenuto. 

This e-mail and its attachments are intended for the addressee(s) only and are confidential and/or may contain legally privileged information. If you have received this message by mistake or are not one of the addressees above, you may take no action based on it, and you may not copy or show it to anyone; please reply to this e-mail and point out the error which has occurred. 
-----------------------------------------------------------------------------------------------------

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: strict_error.txt
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/mondorescue-ia64/attachments/20090316/d0ef654d/attachment.txt">https://lists.berlios.de/pipermail/mondorescue-ia64/attachments/20090316/d0ef654d/attachment.txt</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mondorestore.log.zip
Type: application/x-zip-compressed
Size: 28894 bytes
Desc: mondorestore.log.zip
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/mondorescue-ia64/attachments/20090316/d0ef654d/attachment.bin">https://lists.berlios.de/pipermail/mondorescue-ia64/attachments/20090316/d0ef654d/attachment.bin</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000056.html">[Mondorescue-ia64] R: R: R: R: R: R: R: Recovery	from	tapeKO(OBDR)
</A></li>
	<LI>Next message: <A HREF="000058.html">[Mondorescue-ia64] R: R: R: R: R: R: R: R:	Recovery	fromtapeKO(OBDR)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#57">[ date ]</a>
              <a href="thread.html#57">[ thread ]</a>
              <a href="subject.html#57">[ subject ]</a>
              <a href="author.html#57">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/mondorescue-ia64">More information about the Mondorescue-ia64
mailing list</a><br>
</body></html>
